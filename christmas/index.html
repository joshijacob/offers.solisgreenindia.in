<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Christmas Offer ‚Äî Claim ‚Çπ5,000 | Solis Green Energy</title>
  <meta name="description" content="Unlock an instant ‚Çπ5,000 gift ‚Äî fill the short form with mandatory KSEB details to claim. Limited time offer." />
  <meta name="robots" content="index,follow" />
  <style>
    :root{
      --green-700:#1f7a1f;
      --green-900:#0f3f0f;
      --red-600:#c0392b;
      --gold:#ffd700;
      --card:#ffffff;
      --muted:#6b7280;
      --max-width:980px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Sans","Helvetica Neue";
      background: linear-gradient(180deg,#072214 0%, #0e3a12 60%);
      color:#062018;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:28px 16px;
    }
    .container{
      max-width:var(--max-width);
      margin:0 auto;
    }
    header.hero{
      background: linear-gradient(135deg,var(--red-600),#8b0000);
      color:var(--gold);
      padding:32px;
      border-radius:14px;
      box-shadow:0 12px 30px rgba(0,0,0,0.35);
      text-align:center;
    }
    header.hero h1{
      margin:0 0 6px;
      font-size:clamp(22px,4vw,36px);
      letter-spacing:0.6px;
    }
    header.hero p{margin:0; opacity:0.95}
    .layout{
      display:grid;
      grid-template-columns: 1fr 420px;
      gap:22px;
      margin-top:20px;
    }
    @media (max-width:880px){ .layout{grid-template-columns:1fr} }

    /* left column */
    .card{
      background:var(--card);
      padding:22px;
      border-radius:12px;
      box-shadow:0 8px 22px rgba(0,0,0,0.15);
    }
    .prize-banner{
      text-align:center;
      border-radius:10px;
      padding:18px;
      background:linear-gradient(90deg,#fff7d6,#fff2b0);
      border:3px solid rgba(200,80,50,0.14);
      margin-bottom:16px;
      transform:skewX(-1deg);
    }
    .prize-amount{
      font-size:36px;
      font-weight:800;
      color:var(--red-600);
      text-shadow:0 3px 0 rgba(0,0,0,0.06);
    }
    .muted{ color:var(--muted); font-size:0.95rem; }

    .reveal-area{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:center;
      margin:16px 0 8px;
      flex-wrap:wrap;
    }
    .reveal-btn{
      background:linear-gradient(180deg,var(--green-700),var(--green-900));
      color: #fff;
      border:none;
      border-radius:999px;
      padding:14px 26px;
      font-weight:700;
      cursor:pointer;
      box-shadow:0 8px 20px rgba(0,0,0,0.18);
      transition:transform .14s ease,opacity .14s ease;
      font-size:1rem;
    }
    .reveal-btn[disabled]{opacity:.6; cursor:not-allowed; transform:none}

    .info{
      text-align:center;
      font-size:0.95rem;
      color:#0f2a18;
    }

    /* right column (form) */
    form.claim-form{
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .form-title{
      font-size:1.15rem;
      font-weight:700;
      color:var(--green-900);
      margin-bottom:6px;
    }
    label.small{ font-size:0.9rem; display:block; margin-bottom:6px; font-weight:600; color:#123a12;}
    input[type="text"], input[type="tel"], input[type="email"]{
      padding:12px 14px;
      border-radius:10px;
      border:1px solid #e6e6e6;
      font-size:1rem;
      width:100%;
    }
    input:focus{ outline:3px solid rgba(31,122,31,0.12); border-color:var(--green-700); }
    .muted-note{ font-size:0.9rem; color:var(--muted) }
    .submit-btn{
      background: linear-gradient(180deg,var(--green-900),var(--green-700));
      color:#fff; border:0; padding:14px 18px; border-radius:10px;
      font-weight:800; cursor:pointer; font-size:1rem;
    }
    .submit-btn[disabled]{ opacity:.6; cursor:not-allowed; }

    .small-muted{ font-size:0.86rem; color:var(--muted); }
    .terms{ display:flex; gap:8px; align-items:center; font-size:0.92rem; color:#3a463a; }
    .countdown{ font-weight:800; color:var(--red-600); }

    /* aria-live */
    .sr-live{ position: absolute; left:-9999px; width:1px; height:1px; overflow:hidden; }

    footer p{ color:#e6f0e6; text-align:center; margin-top:20px; font-size:0.95rem; }

    /* tiny helpers */
    .row{ display:flex; gap:10px }
    .error{ color:#b91c1c; font-size:0.9rem; }
    .success{ color:#0a7a23; font-size:0.96rem; }
  </style>
</head>
<body>
  <div class="container" role="main">
    <header class="hero" role="banner" aria-labelledby="page-title">
      <h1 id="page-title">üéÑ Christmas Offer ‚Äî Unlock ‚Çπ5,000 Instantly</h1>
      <p>Fill the short form with mandatory KSEB details to claim. Slot reserved for a short time ‚Äî submit to confirm.</p>
    </header>

    <div style="height:18px"></div>

    <div class="layout">
      <!-- Left: Prize area & explanation -->
      <section class="card" aria-labelledby="prize-heading">
        <h2 id="prize-heading" class="muted">How it works</h2>

        <div class="prize-banner" role="region" aria-live="polite" aria-atomic="true">
          <div style="font-size:0.95rem; font-weight:700; color:#4b3b00">INSTANT GIFT</div>
          <div class="prize-amount">‚Çπ5,000</div>
          <div class="muted">Payable to every <strong>confirmed</strong> customer after verification & commissioning</div>
        </div>

        <p class="info muted">
          Click <strong>Unlock Your Gift</strong> to reserve a slot for <strong>10 minutes</strong>. You must submit the claim form (mandatory KSEB Consumer No. & KSEB Reg. Phone) before the timer ends ‚Äî otherwise the slot is released.
        </p>

        <div class="reveal-area">
          <button id="revealBtn" class="reveal-btn" aria-describedby="reveal-desc">üéÅ Unlock Your Gift</button>
        </div>

        <p id="reveal-desc" class="muted-note" style="text-align:center">One reveal per person. Duplicate or fraudulent claims may be rejected.</p>

        <div id="revealResult" style="margin-top:14px;display:none">
          <p class="success" id="revealMessage"></p>
          <p class="small-muted">Reservation expires in <span id="countdown" class="countdown">--:--</span></p>
        </div>

        <div id="revealErrors" style="margin-top:12px"></div>

        <hr style="margin:18px 0; border:none; border-top:1px solid #f2f2f2" />

        <div>
          <p class="muted-note"><strong>Important:</strong> Payment of ‚Çπ5,000 is processed only after verification and commissioning. We will contact you on the phone number you provide.</p>
        </div>
      </section>

      <!-- Right: Form -->
      <aside class="card" aria-labelledby="form-heading">
        <h3 id="form-heading" class="form-title">Claim Form</h3>

        <form id="claimForm" class="claim-form" autocomplete="off" novalidate>
          <input type="hidden" id="revealToken" name="revealToken" />

          <div>
            <label class="small" for="name">Customer Name *</label>
            <input type="text" id="name" name="name" maxlength="100" required />
          </div>

          <div>
            <label class="small" for="phone">Contact Number (10 digits) *</label>
            <input type="tel" id="phone" name="phone" inputmode="numeric" placeholder="e.g. 9XXXXXXXXX" required />
          </div>

          <div>
            <label class="small" for="ksebConsumer">KSEB Consumer Number *</label>
            <input type="text" id="ksebConsumer" name="ksebConsumer" placeholder="Enter your KSEB consumer number" required />
          </div>

          <div>
            <label class="small" for="ksebPhone">KSEB Registered Phone Number *</label>
            <input type="tel" id="ksebPhone" name="ksebPhone" inputmode="numeric" placeholder="KSEB registered phone" required />
          </div>

          <div>
            <label class="small" for="location">Location (Town / Pincode) *</label>
            <input type="text" id="location" name="location" required placeholder="Eg: Thiruvalla, 689101" />
          </div>

          <div class="terms" style="margin-top:6px">
            <input type="checkbox" id="consent" required />
            <label for="consent" class="small-muted">I consent to be contacted about this offer and agree to the <a href="#" target="_blank">Terms & Privacy</a>.</label>
          </div>

          <div id="formFeedback" aria-live="polite" style="min-height:1.5em"></div>

          <button id="submitBtn" class="submit-btn" type="submit" disabled>Claim ‚Çπ5,000 & Get Free Consultation</button>

          <p class="small-muted" style="margin-top:8px">If you do not have the reveal slot, click "Unlock Your Gift" first.</p>
        </form>
      </aside>
    </div>

    <div style="height:18px"></div>

    <footer style="text-align:center; color:#dfeee1;">
      <p>¬© <span id="year"></span> Solis Green Energy Solutions ‚Äî offers.solisgreenindia.in</p>
    </footer>

    <!-- live region for screen readers -->
    <div class="sr-live" id="liveRegion" aria-live="polite"></div>
  </div>

  <script>
    (function(){
      // ------- Configuration -------
      const REVEAL_API = '/api/reveal'; // production: serverless endpoint
      const CLAIM_API  = '/api/claim';  // production: serverless endpoint
      const DEFAULT_TTL_SECONDS = 600; // fallback TTL (10 minutes) used in demo mode
      const ALLOW_FALLBACK = true;     // if API not present, page works in demo mode
      // ------------------------------

      // Elements
      const revealBtn = document.getElementById('revealBtn');
      const revealResult = document.getElementById('revealResult');
      const revealMessage = document.getElementById('revealMessage');
      const countdownEl = document.getElementById('countdown');
      const revealErrors = document.getElementById('revealErrors');

      const claimForm = document.getElementById('claimForm');
      const submitBtn = document.getElementById('submitBtn');
      const revealTokenInput = document.getElementById('revealToken');
      const formFeedback = document.getElementById('formFeedback');
      const liveRegion = document.getElementById('liveRegion');

      let reservation = null; // { token, expiresAt (ms) }
      let countdownTimer = null;

      // utility: format seconds to MM:SS
      function formatSeconds(s){
        s = Math.max(0, Math.floor(s));
        const m = Math.floor(s/60).toString().padStart(2,'0');
        const sec = (s%60).toString().padStart(2,'0');
        return `${m}:${sec}`;
      }

      // show message in live region for screen readers
      function announce(msg){
        liveRegion.textContent = msg;
        setTimeout(()=> liveRegion.textContent = '', 1500);
      }

      // Start countdown to expiration
      function startCountdown(expiresAtMs){
        clearInterval(countdownTimer);
        function tick(){
          const now = Date.now();
          const remaining = Math.max(0, Math.ceil((expiresAtMs - now)/1000));
          countdownEl.textContent = formatSeconds(remaining);
          if (remaining <= 0){
            clearInterval(countdownTimer);
            onReservationExpired();
          }
        }
        tick();
        countdownTimer = setInterval(tick, 1000);
      }

      function onReservationExpired(){
        reservation = null;
        revealResult.style.display = 'none';
        revealErrors.innerHTML = '<div class="error">‚è≥ Your reservation expired. Please click "Unlock Your Gift" again to try.</div>';
        revealBtn.disabled = false;
        revealBtn.textContent = 'üéÅ Unlock Your Gift';
        revealTokenInput.value = '';
        submitBtn.disabled = true;
        announce('Reservation expired');
      }

      // Basic client-side validations
      function validatePhone(v){ return /^[6-9]\d{9}$/.test(v.trim()); }
      function validateKsebConsumer(v){ return /^[A-Za-z0-9\-]{5,20}$/.test(v.trim()); }

      // Called when reveal button clicked
      async function handleReveal(){
        revealErrors.innerHTML = '';
        revealBtn.disabled = true;
        revealBtn.textContent = 'üéÖ Checking your gift...';

        // Try to call server endpoint
        try {
          const resp = await fetch(REVEAL_API, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ campaign: 'christmas' }) });
          if (!resp.ok) throw new Error('Server returned ' + resp.status);
          const data = await resp.json();
          // Expected server response: { prize:5000, revealToken: "...", expiresIn: 600 }
          const prize = data.prize ?? 5000;
          const token = data.revealToken ?? data.token ?? null;
          const ttl = parseInt(data.expiresIn ?? data.ttl ?? DEFAULT_TTL_SECONDS, 10);

          if (!token){
            throw new Error('Missing reveal token from server.');
          }

          reservation = {
            token,
            prize,
            expiresAt: Date.now() + (ttl * 1000)
          };
          revealTokenInput.value = token;
          revealMessage.textContent = `üéâ You have unlocked ‚Çπ${prize.toLocaleString()} ‚Äî fill the form to claim within the time limit.`;
          revealResult.style.display = 'block';
          revealErrors.innerHTML = '';
          revealBtn.textContent = 'üéÅ Gift Reserved';
          startCountdown(reservation.expiresAt);
          submitBtn.disabled = false;
          announce('Gift reserved. Form is available.');
        } catch(err){
          // If API missing or failed, optionally fallback to demo mode
          console.warn('Reveal API failed:', err);
          if (ALLOW_FALLBACK){
            // Demo: create a local reservation token that expires in DEFAULT_TTL_SECONDS
            const demoToken = 'demo-' + Math.random().toString(36).slice(2,12);
            reservation = {
              token: demoToken,
              prize: 5000,
              expiresAt: Date.now() + DEFAULT_TTL_SECONDS*1000
            };
            revealTokenInput.value = demoToken;
            revealMessage.textContent = `üéâ Demo: You have unlocked ‚Çπ${reservation.prize.toLocaleString()}. This is a local demo reservation ‚Äî integrate server APIs for production.`;
            revealResult.style.display = 'block';
            revealBtn.textContent = 'üéÅ Gift Reserved (demo)';
            startCountdown(reservation.expiresAt);
            submitBtn.disabled = false;
            announce('Demo gift reserved. Form is available.');
          } else {
            revealErrors.innerHTML = '<div class="error">Unable to reserve gift right now. Please try again later.</div>';
            revealBtn.disabled = false;
            revealBtn.textContent = 'üéÅ Unlock Your Gift';
          }
        }
      }

      // Claim form submission
      claimForm.addEventListener('submit', async function(e){
        e.preventDefault();
        formFeedback.textContent = '';
        if (!reservation){
          formFeedback.innerHTML = '<div class="error">You need to reserve a slot first ‚Äî click "Unlock Your Gift".</div>';
          return;
        }
        if (Date.now() > reservation.expiresAt){
          onReservationExpired();
          return;
        }

        // collect data
        const payload = {
          revealToken: revealTokenInput.value,
          name: document.getElementById('name').value.trim(),
          phone: document.getElementById('phone').value.trim(),
          ksebConsumer: document.getElementById('ksebConsumer').value.trim(),
          ksebPhone: document.getElementById('ksebPhone').value.trim(),
          location: document.getElementById('location').value.trim(),
          campaign: 'christmas'
        };

        // client validations
        if (!payload.name){ formFeedback.innerHTML = '<div class="error">Please enter your name.</div>'; return; }
        if (!validatePhone(payload.phone)){ formFeedback.innerHTML = '<div class="error">Enter a valid 10-digit mobile number (starts with 6-9).</div>'; return; }
        if (!validateKsebConsumer(payload.ksebConsumer)){ formFeedback.innerHTML = '<div class="error">Enter a valid KSEB Consumer Number (alphanumeric).</div>'; return; }
        if (!validatePhone(payload.ksebPhone)){ formFeedback.innerHTML = '<div class="error">Enter a valid KSEB registered phone (10 digits).</div>'; return; }
        if (!payload.location){ formFeedback.innerHTML = '<div class="error">Please enter your location (town / pincode).</div>'; return; }
        if (!document.getElementById('consent').checked){ formFeedback.innerHTML = '<div class="error">You must consent to be contacted about this offer.</div>'; return; }

        // disable submit while sending
        submitBtn.disabled = true;
        submitBtn.textContent = '‚è≥ Submitting...';

        try {
          const resp = await fetch(CLAIM_API, {
            method:'POST',
            headers:{ 'Content-Type':'application/json' },
            body: JSON.stringify(payload)
          });

          if (!resp.ok) {
            // try to parse error message
            let msg = 'Server error. Please try again.';
            try { const j = await resp.json(); if (j?.error) msg = j.error; } catch(e){}
            throw new Error(msg);
          }
          const data = await resp.json();
          // Expected response: { success:true, message: "...", claimId: "..." }
          formFeedback.innerHTML = `<div class="success">‚úÖ ${data.message ?? 'Claim submitted. We will contact you within 24 hours.'}</div>`;
          announce('Claim submitted successfully.');
          // clear reservation locally to prevent re-submission
          reservation = null;
          revealTokenInput.value = '';
          revealResult.style.display = 'none';
          clearInterval(countdownTimer);
          revealBtn.disabled = false;
          revealBtn.textContent = 'üéÅ Unlock Your Gift';
          // optionally reset form
          claimForm.reset();
        } catch(err){
          formFeedback.innerHTML = `<div class="error">${err.message}</div>`;
          submitBtn.disabled = false;
          submitBtn.textContent = 'Claim ‚Çπ5,000 & Get Free Consultation';
        }
      });

      // Attach reveal handler
      revealBtn.addEventListener('click', handleReveal);

      // page init
      document.getElementById('year').textContent = new Date().getFullYear();

      // Accessibility: enable submit only when revealToken exists
      const observer = new MutationObserver(()=>{
        submitBtn.disabled = !revealTokenInput.value;
      });
      observer.observe(revealTokenInput, { attributes:true, childList:false, subtree:false });

    })();
  </script>
</body>
</html>
